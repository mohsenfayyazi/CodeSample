using Equipment.Codes.Security;
using Equipment.Models;
using Kendo.Mvc.Extensions;
using Kendo.Mvc.UI;
using System.Collections.Generic;
using System.Linq;
using System.Web.Mvc;

namespace Equipment.Controllers.Exploitation.STATICINFO
{
    public partial class Static_LineController
    {
        //
        // GET: /Static_Post_Instrument/
        public void Load_Line_InstrumentGrid()
        {
            ViewData["EINS"] = Db.EXP_INSTRUMENT.Select(c => new { EINS_ID = c.EINS_ID, mEINS_DESC = c.EINS_DESC });
            ViewData["ETEX"] = Db.EXP_TYPE_EQUIP.Select(c => new { ETEX_ID = c.ETEX_ID, ETEX_DESC = c.ETEX_DESC });
        }

        public ActionResult Static_Line_Instrumnet()
        {
            Load_Line_InstrumentGrid();
            return View("Static_Line_Instrumnet");
        }

        [EntityAuthorize("EXP_POST_LINE_INSTRU > select")]
        public ActionResult Read_Line_Instrument([DataSourceRequest] DataSourceRequest request)
        {
            return Json(Get_Line_Instrument().ToDataSourceResult(request));
        }

        [EntityAuthorize("EXP_POST_LINE_INSTRU > select")]
        //private static IEnumerable<EXP_POST_LINE_INSTRU> Get_Line_Instrument()
        public IEnumerable<EXP_POST_LINE_INSTRU> Get_Line_Instrument()
        {
            var query = (from b in Db.EXP_POST_LINE_INSTRU select b).ToList();
            return query;
        }

        [EntityAuthorize("EXP_POST_LINE_INSTRU > select,insert")]
        public RedirectResult Add_Line_Instrument(EXP_POST_LINE_INSTRU model)
        {
            Db.EXP_POST_LINE_INSTRU.Add(model);
            Db.SaveChanges();
            return new RedirectResult("Static_Line_Instrumnet");
        }

        [EntityAuthorize("EXP_POST_LINE_INSTRU > select,delete")]
        public ActionResult Remove_Line_Instrument(EXP_POST_LINE_INSTRU model)
        {
            var myobj = Db.EXP_POST_LINE_INSTRU.FirstOrDefault(b => b.EPIU_ID == model.EPIU_ID);
            Db.EXP_POST_LINE_INSTRU.Remove(myobj);
            Db.SaveChanges();
            Load_Line_InstrumentGrid();
            return View("Static_Line_Instrumnet");
        }

        [EntityAuthorize("EXP_POST_LINE_INSTRU > select,update")]
        public ActionResult Update_Line_Instrument(EXP_POST_LINE_INSTRU model)
        {
            var myobj = Db.EXP_POST_LINE_INSTRU.FirstOrDefault(b => b.EPIU_ID == model.EPIU_ID);
            myobj.ETEX_ETEX_ID = model.ETEX_ETEX_ID;
            myobj.EINS_EINS_ID = model.EINS_EINS_ID;
            myobj.CODE_DISP = model.CODE_DISP;
            myobj.CODE_NAME = model.CODE_NAME;
            myobj.OUIN_TYPE = model.OUIN_TYPE;
            myobj.EPIU_TYPE = model.EPIU_TYPE;
            Db.SaveChanges();
            Load_Line_InstrumentGrid();
            return View("Static_Line_Instrumnet");
        }
    }
}
