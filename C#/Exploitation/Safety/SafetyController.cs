using Equipment.Models;
using System.Linq;
using System.Web.Mvc;

namespace Equipment.Controllers.Exploitation.Safety
{
    [Authorize]
    public class SafetyController : DbController
    {
        //BandarEntities Db;

        ////سازنده کلاس
        //public SafetyController()
        //{
        //    Db = GlobalConst.DB();
        //}

        ////مخرب کلاس
        //~SafetyController()
        //{
        //    //این دستور کانکشن را دیسکانکت میکند
        //    Db.Dispose();
        //}

        public ActionResult SafetyFolder()
        {
            string PRSN_EMP_NUMB = Request.Form["PRSN_EMP_NUMB"];
            Session["PRSN_EMP_NUMB"] = PRSN_EMP_NUMB;
            return View("Saf_SafetyFolder_F");
        }

        public ActionResult ShowContract()
        {
            return View("Saf_ShowContract_F");
        }

        public ActionResult AddCapsule()
        {
            ViewData["post"] = Db.EXP_POST_LINE.Select(o => new { o.EPOL_ID, o.EPOL_NAME }).AsEnumerable();
            return View("Saf_AddCapsule_F");
        }

        [HttpPost]
        public string update_contract(CNT_CONTRACT objecttemp)
        {
            objecttemp.CNT_SAFE = short.Parse("1");
            string sql = string.Format("update cnt_contract set cnt_safe='1' where CNTR_NO='{0}'", objecttemp.CNTR_NO);
            Db.Database.ExecuteSqlCommand(sql);
            return (objecttemp.CNTR_NO.ToString());
        }

    }

}
